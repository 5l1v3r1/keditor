/*!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 1.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, $.fn.ckeditor
 *
 * Configuration:
 * @option {Object} ckeditor Configuration for CKEditor. See at http://docs.ckeditor.com/#!/api/CKEDITOR.config
 * @option {String} snippetsUrl Url to snippets file
 * @option {String} [snippetsListId="keditor-snippets-list"] Id of element which contains snippets. As default, value is "keditor-snippets-list" and KEditor will render snippets sidebar automatically. If you specific other id, only snippets will rendered and put into your element
 */
!function(t){var e=function(){"undefined"!=typeof console&&t.fn.keditor.debug&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},i=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||i("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||i("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||i("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),t.fn.ckeditor?CKEDITOR.disableAutoInline=!0:i("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),t.fn.keditor=function(t){if(s[t]&&"init"!==t)return s[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on jquery.keditor");return s.init.apply(this,arguments)},t.fn.keditor.debug=!0,t.fn.keditor.version="1.0.0";var n=t.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets.html",snippetsListId:"keditor-snippets-list",onContentChange:function(){}},o={initSnippet:function(s,r){e("initSnippetToggler",s,r);var a=t(document.body);a.addClass("opened-keditor-snippets"),s.addClass("keditor-content-area"),r.snippetsListId===n.snippetsListId?(e("Render default KEditor snippet container"),a.append('<div id="keditor-snippets-container">    <a id="keditor-snippets-toggler"><i class="glyphicon glyphicon-chevron-right"></i></a>    <div id="keditor-snippets-list" class="clearfix"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),o.initSnippetToggler()):(e('Render KEditor snippets content after custom snippets list with id="'+r.snippetsListId+'"'),t("#"+r.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof r.snippetsUrl&&r.snippetsUrl.length>0?(e('Getting snippets form "'+r.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:r.snippetsUrl,success:function(t){e("Success in getting snippets",t),o.renderSnippets(t,r),o.initSnippetsActions(s,r),o.initContentAreaActions(s,r)},error:function(t){e("Error when getting snippets",t)}})):i('"snippetsUrl" must be not null!')},initSnippetToggler:function(){e("initSnippetToggler");var i=t(document.body);t("#keditor-snippets-toggler").on("click",function(e){e.preventDefault();var n=t(this).find("i");i.hasClass("opened-keditor-snippets")?(i.removeClass("opened-keditor-snippets"),n.attr("class","glyphicon glyphicon-chevron-left")):(i.addClass("opened-keditor-snippets"),n.attr("class","glyphicon glyphicon-chevron-right"))})},renderSnippets:function(i,n){e("renderSnippets",i,n);var o="",s="";t("<div />").html(i).find("> div").each(function(i){var n=t(this),r=n.html().trim(),a=n.attr("data-preview");e("Snippet #"+i,a,r),o+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+i+'">',o+='   <img class="keditor-snippet-preview" src="'+a+'" />',o+="</section>",s+='<div id="keditor-snippet-'+i+'" style="display: none;">'+r+"</div>"}),t("#"+n.snippetsListId).html(o),t("#keditor-snippets-content").html(s)},initSnippetsActions:function(i,n){e("initSnippetsActions",i,n);var o=t("#"+n.snippetsListId);t.fn.niceScroll?(e("Initialize $.fn.niceScroll for snippets list"),o.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):e("$.fn.niceScroll does not exist. Use default sidebar.");var s=i.attr("id");e("Initialize $.fn.draggable for snippets list which connect to #"+s),o.find(".keditor-snippet").draggable({helper:"clone",revert:"invalid",connectToSortable:"#"+s,cursorAt:{top:0,left:0},start:function(){t(".keditor-section-content").blur()}})},initContentAreaActions:function(i,n){e("initContentAreaActions",i,n);var s=t(document.body),r=i.attr("id");e("Initialize $.fn.droppable for content area"),i.droppable({accept:".keditor-snippet",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),i.sortable({handle:".btn-section-reposition",items:"> section",connectWith:"#"+r,axis:"y",sort:function(){t(this).removeClass("ui-state-default")},receive:function(i,s){e("On received snippet",i,s);var r=s.helper,a=s.item,d=t(a.attr("data-snippet")).html();e("Snippet content",d);var c=t('<section class="keditor-section">   <section class="keditor-section-content">'+d+"</section></section>");r.replaceWith(c),o.initContentEditable(c,n)}}),e("Initialize sections in content area"),i.find("> section").each(function(){var e=t(this);e.addClass("keditor-section-content"),e.wrap('<section class="keditor-section"></section>');var i=e.parent();o.initContentEditable(i,n)}),s.on("click",function(t){var n=o.getClickElement(t,"section.keditor-section");i.find(".keditor-section.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n&&(e("Click on .keditor-section"),n.addClass("showed-keditor-toolbar"));var s=o.getClickElement(t,".btn-section-delete");if(s&&(e("Click on .btn-section-delete",s),confirm("Are you sure that you want to delete this section? This action can not be undo!"))){var r=s.closest("section.keditor-section"),a=r.find(".keditor-section-content").attr("id");CKEDITOR.instances[a].destroy(),r.remove(),e("Section is deleted")}})},getClickElement:function(e,i){var n=t(e.target),o=n.closest(i);return n.is(i)?n:o.length>0?o:null},initContentEditable:function(t,i){if(e("initContentEditable",t,i),t.hasClass("keditor-editable")&&t.hasClass("keditor-initializing"))e(t.hasClass("keditor-editable")?"Section is already initialized!":"Section is initializing...");else{t.addClass("keditor-initializing"),e("Render KEditor toolbar for section",t),t.append('<div class="keditor-toolbar">   <div class="btn-group-vertical">       <a href="#" class="btn btn-xs btn-info btn-section-reposition"><i class="glyphicon glyphicon-sort"></i></a>       <a href="#" class="btn btn-xs btn-danger btn-section-delete"><i class="glyphicon glyphicon-remove"></i></a>   </div></div>'),e("Initialize CKEditor for section",t);var n=t.find(".keditor-section-content");n.prop("contenteditable",!0);var o="keditor-section-"+(new Date).getTime();e("Id for section content is: "+o),n.attr("id",o);var s=n.ckeditor(i.ckeditor).editor;s.on("instanceReady",function(t){e("CKEditor is ready",s,t),s.on("change",function(t){"function"==typeof i.onContentChange&&i.onContentChange.call(this,s,t)})}),t.addClass("keditor-editable"),t.removeClass("keditor-initializing")}}},s={init:function(i){return t(this).each(function(){var s=t(this);if(s.data("keditorOptions"))e("KEditor is already initialized!");else{if(0===s.attr("id").length){e("Content area does not contain Id. Generating id for content area...");var r="keditor-content-area-"+(new Date).getTime();s.attr("id",r),e('Id for content are is: "'+r+'"')}i=t.extend({},n,i),s.data("keditorOptions",i),o.initSnippet(s,i)}return s})},getContent:function(){var e=t(this),i="";return e.find("> section").each(function(){var e=t(this),n=e.find(".keditor-section-content").attr("id");i+="<section>"+CKEDITOR.instances[n].getData()+"</section>"}),i}}}(jQuery);
//# sourceMappingURL=keditor-1.0.0.min.js.map
