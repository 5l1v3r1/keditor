/*!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 1.1.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, $.fn.ckeditor, Bootstrap, FontAwesome
 *
 * Configuration:
 * @option {Object} ckeditor Configuration for CKEditor. See at http://docs.ckeditor.com/#!/api/CKEDITOR.options
 * @option {String} snippetsUrl Url to snippets file
 * @option {String} [snippetsListId="keditor-snippets-list"] Id of element which contains snippets. As default, value is "keditor-snippets-list" and KEditor will render snippets sidebar automatically. If you specific other id, only snippets will rendered and put into your element
 * @option {Function} onInitContent Method will be called when initializing content area. It can return array of jQuery objects which will be initialized as editable section in content area. By default, all first level sections under content area will be initialized.
 * @option {Function} onInitSection Method will be called when initializing section after dropped snippet into content are. Arguments: section
 * @option {Function} onSectionReady Method will be called after section is initialized. Arguments: section
 * @option {Function} onContentChanged Callback will be called when content is changed. Arguments: event
 * @option {Function} onSnippetDropped Callback will be called when snippet is dropped into content area. Arguments: event, newSection, droppedSnippet
 * @option {Function} onBeforeSectionDeleted Callback will be called before selected section is deleted. Arguments: event, btnRemove, selectedSection
 * @option {Function} onSectionChanged Callback will be called when content of section is changed. Arguments: event, changedSection
 * @option {Function} onSectionDuplicated Callback will be called when section is duplicated. Arguments: event, originalSection, newSection
 * @option {Function} onSectionSelected Callback will be called when section is selected. Arguments: event, selectedSection
 */
!function(t){var e=function(){"undefined"!=typeof console&&t.fn.keditor.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},n=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||n("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||n("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||n("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),t.fn.ckeditor?CKEDITOR.disableAutoInline=!0:n("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),t.fn.keditor=function(t){if(s[t]&&"init"!==t)return s[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on jquery.keditor");return s.init.apply(this,arguments)},t.fn.keditor.debug=!0,t.fn.keditor.version="1.0.0";var i=t.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onInitContent:function(t){},onInitSection:function(t){},onSectionReady:function(t){},onContentChanged:function(t){},onSnippetDropped:function(t,e,n){},onBeforeSectionDeleted:function(t,e,n){},onSectionChanged:function(t,e){},onSectionDuplicated:function(t,e,n){},onSectionSelected:function(t,e){}},o={initSidebar:function(s,a){e("initSidebar",s,a);var r=t(document.body);r.addClass("opened-keditor-sidebar"),a.snippetsListId===i.snippetsListId?(e("Render default KEditor snippet container"),r.append('<div id="keditor-sidebar">    <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>    <div id="keditor-snippets-list"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),o.initSidebarToggler()):(e('Render KEditor snippets content after custom snippets list with id="'+a.snippetsListId+'"'),t("#"+a.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof a.snippetsUrl&&a.snippetsUrl.length>0?(e('Getting snippets form "'+a.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:a.snippetsUrl,success:function(t){e("Success in getting snippets",t),o.renderSnippets(t,a),o.initSnippets(s,a),o.initSnippetsSwitcher(a)},error:function(t){e("Error when getting snippets",t)}})):n('"snippetsUrl" must be not null!')},initSidebarToggler:function(){e("initSidebarToggler");var n=t(document.body);t("#keditor-sidebar-toggler").on("click",function(e){e.preventDefault();var i=t(this).find("i");n.hasClass("opened-keditor-sidebar")?(n.removeClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-left")):(n.addClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-right"))})},renderSnippets:function(n,i){e("renderSnippets",n,i);var o="",s="",a="";t("<div />").html(n).find("> div").each(function(n){var i=t(this),r=i.html().trim(),c=i.attr("data-preview"),d=i.attr("data-type"),l="";e("Snippet #"+n+" type="+d,c,r),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+n+'" data-type="'+d+'">',l+='   <img class="keditor-snippet-preview" src="'+c+'" />',l+="</section>","container"===d?o+=l:"component"===d&&(s+=l),a+='<div id="keditor-snippet-'+n+'" style="display: none;">'+r+"</div>"}),t("#"+i.snippetsListId).html('<ul class="keditor-snippets-type-switcher nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div class="keditor-snippets-container tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+o+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+s+"</div></div>").addClass("loaded-snippets"),t("#keditor-snippets-content").html(a)},initSnippets:function(n,i){e("initSnippets",n,i);var o=t("#"+i.snippetsListId);t.fn.niceScroll?(e("Initialize $.fn.niceScroll for snippets list"),o.find(".keditor-snippets").niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):e("$.fn.niceScroll does not exist. Use default sidebar."),e("Initialize $.fn.draggable for snippets list which connect to "+n),o.find(".keditor-snippet").draggable({helper:"clone",revert:"invalid",connectToSortable:n,cursorAt:{top:0,left:0},start:function(){t(".keditor-section-content").blur()}})},initSnippetsSwitcher:function(n){e("initSnippetsSwitcher",n);var i=t("#"+n.snippetsListId),o=i.find(".keditor-snippets-type-switcher li"),s=i.find(".keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();var n=t(this),i=n.parent(),a=n.attr("href");if(!i.hasClass("active")){var r=o.filter(".active"),c=s.filter(".active"),d=t(a);r.removeClass("active"),c.removeClass("active"),i.addClass("active"),d.addClass("active"),t.fn.niceScroll&&(c.getNiceScroll().hide(),d.getNiceScroll().show())}})},initContentArea:function(n,i,s){if(e("initContentArea",n,i,s),n.addClass("keditor-content-area"),e("Initialize $.fn.droppable for content area"),n.droppable({accept:".keditor-snippet",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),n.sortable({handle:".btn-section-reposition",items:"> section",connectWith:i,axis:"y",sort:function(){t(this).removeClass("ui-state-default")},receive:function(i,a){e("On received snippet",i,a);var r=a.helper,c=a.item,d=t(c.attr("data-snippet")).html();e("Snippet content",d);var l=t('<section class="keditor-section">   <section class="keditor-section-content">'+d+"</section></section>");r.replaceWith(l),"function"==typeof s.onSnippetDropped&&s.onSnippetDropped.call(n,i,l,a.item),o.initSection(l,s),"function"==typeof s.onContentChanged&&s.onContentChanged.call(n,i)}}),e("Initialize existing sections in content area"),n.find("> section").each(function(){var e=t(this);e.addClass("keditor-section-content"),e.wrap('<section class="keditor-section"></section>');var n=e.parent();o.initSection(n,s)}),"function"==typeof s.onInitContent){var a=s.onInitContent.call(n,n);a&&a.length>0&&t.each(a,function(){var e=t(this);e.wrap('<section class="keditor-section"><section class="keditor-section-content"></section></section>');var n=e.parent().parent();o.initSection(n,s)})}},initSection:function(t,n){if(e("initSection",t,n),t.hasClass("keditor-editable")&&t.hasClass("keditor-initializing"))e(t.hasClass("keditor-editable")?"Section is already initialized!":"Section is initializing...");else{t.addClass("keditor-initializing"),e("Render KEditor toolbar for section",t),t.append('<div class="keditor-toolbar">   <div class="btn-group-vertical">       <a href="#" class="btn btn-xs btn-info btn-section-reposition"><i class="fa fa-sort"></i></a>       <a href="#" class="btn btn-xs btn-warning btn-section-duplicate"><i class="fa fa-files-o"></i></a>       <a href="#" class="btn btn-xs btn-danger btn-section-delete"><i class="fa fa-times"></i></a>   </div></div>'),e("Initialize CKEditor for section",t);var i=t.find(".keditor-section-content");i.prop("contenteditable",!0);var o="keditor-section-"+(new Date).getTime();e("Id for section content is: "+o),i.attr("id",o);var s=t.parent(),a=i.ckeditor(n.ckeditor).editor;i.on("input",function(e){"function"==typeof n.onSectionChanged&&n.onSectionChanged.call(s,e,t),"function"==typeof n.onContentChanged&&n.onContentChanged.call(s,e)}),a.on("instanceReady",function(){e("CKEditor is ready",t),"function"==typeof n.onSectionReady&&n.onSectionReady.call(s,t)}),"function"==typeof n.onInitSection&&n.onInitSection.call(s,t),t.addClass("keditor-editable"),t.removeClass("keditor-initializing")}},getClickElement:function(e,n){var i=t(e.target),o=i.closest(n);return i.is(n)?i:o.length>0?o:null},initSectionActions:function(n){e("initSectionActions",n);var i=t(document.body);i.on("click",function(i){var s=o.getClickElement(i,"section.keditor-section");if(s&&(e("Click on .keditor-section",s),!s.hasClass("showed-keditor-toolbar"))){t(".keditor-section.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var a=s.parent();"function"==typeof n.onSectionSelected&&n.onSectionSelected.call(a,i,s)}var r=o.getClickElement(i,".btn-section-delete");if(r&&(i.preventDefault(),e("Click on .btn-section-delete",r),confirm("Are you sure that you want to delete this section? This action can not be undo!"))){var c=r.closest("section.keditor-section"),a=s.parent();"function"==typeof n.onBeforeSectionDeleted&&n.onBeforeSectionDeleted.call(a,i,r,c);var d=c.find(".keditor-section-content").attr("id");CKEDITOR.instances[d]&&CKEDITOR.instances[d].destroy(),c.remove(),e("Section is deleted"),"function"==typeof n.onContentChanged&&n.onContentChanged.call(a,i)}var l=o.getClickElement(i,".btn-section-duplicate");if(l){i.preventDefault(),e("Click on .btn-section-duplicate",l);var c=l.closest("section.keditor-section"),p=o.getSectionContent(c),a=s.parent(),f=t('<section class="keditor-section">   <section class="keditor-section-content">'+p+"</section></section>");c.after(f),o.initSection(f,n),e("Section is duplicated"),"function"==typeof n.onSectionDuplicated&&n.onSectionDuplicated.call(a,i,c,f),"function"==typeof n.onContentChanged&&n.onContentChanged.call(a,i)}})},getSectionContent:function(t){var e=t.find(".keditor-section-content").attr("id");return CKEDITOR.instances[e].getData()}},s={init:function(n){var s=t(this),a=[];n=t.extend({},i,n),s.each(function(){var n=t(this);if(0===n.attr("id").length){e("Content area does not contain Id. Generating id for content area...");var i="keditor-content-area-"+(new Date).getTime();n.attr("id",i),e('Id for content are is: "'+i+'"')}a.push("#"+n.attr("id"))}),a=a.join(","),e("Content areas' ids: "+a);var r=t("#"+n.snippetsListId);return r.hasClass("loaded-snippets")?e("Snippets list is already initialized!"):o.initSidebar(a,n),o.initSectionActions(n),s.each(function(){var i=t(this);i.data("keditorOptions")?e("KEditor is already initialized!"):(i.data("keditorOptions",n),o.initContentArea(i,a,n))}),s},getContent:function(e){var n=t(this),i="";return n.find("> section").each(function(){var n=t(this);e&&(i+="<section>"),i+=o.getSectionContent(n),e&&(i+="</section>")}),i}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
