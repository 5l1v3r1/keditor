/*!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 1.1.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, $.fn.ckeditor, Bootstrap, FontAwesome
 *
 * Configuration:
 * @option {Object} ckeditor Configuration for CKEditor. See at http://docs.ckeditor.com/#!/api/CKEDITOR.options
 * @option {String} snippetsUrl Url to snippets file
 * @option {String} [snippetsListId="keditor-snippets-list"] Id of element which contains snippets. As default, value is "keditor-snippets-list" and KEditor will render snippets sidebar automatically. If you specific other id, only snippets will rendered and put into your element
 * @option {Function} onInitContentArea Method will be called when initializing content area. It can return array of jQuery objects which will be initialized as editable section in content area. By default, all first level sections under content area will be initialized. Arguments: contentArea
 * @option {Function} onContentChanged Callback will be called when content is changed. Includes add, delete, duplicate container or component. Or content of a component is changed. Arguments: event
 * @option {Function} onInitContainer Callback will be called when initializing container. Arguments: container
 * @option {Function} onBeforeContainerDeleted Callback will be called before container is deleted. Arguments: event, selectedContainer
 * @option {Function} onContainerDeleted Callback will be called after container and its components are already deleted. Arguments: event, selectedContainer
 * @option {Function} onContainerChanged Callback will be called when content of container is changed. It can be when container received new component from snippet or from other container. Or content of any components are changed or any components are deleted or duplicated. Arguments: event, changedContainer
 * @option {Function} onContainerDuplicated Callback will be called when a container is duplicated. Arguments: event, originalContainer, newContainer
 * @option {Function} onContainerSelected Callback will be called when a container is selected. Arguments: event, selectedContainer
 * @option {Function} onContainerSnippetDropped Callback will be called when a container snippet is dropped into content area. Arguments: event, newContainer, droppedContainer
 * @option {Function} onInitComponent Callback will be called when initializing component. Arguments: component
 * @option {Function} onComponentReady Callback will be called after initializing component, when CKEditor of component content is ready. Arguments: component
 * @option {Function} onBeforeComponentDeleted Callback will be called before a component is deleted. Arguments: event, selectedComponent
 * @option {Function} onComponentDeleted Callback will be called after a component is deleted. Arguments: event, selectedComponent
 * @option {Function} onComponentChanged Callback will be called when content of a component is changed. Arguments: event, changedComponent
 * @option {Function} onComponentDuplicated Callback will be called when a component is duplicated. Arguments: event, originalComponent, newComponent
 * @option {Function} onComponentSelected Callback will be called when a component is selected. Arguments: event, selectedComponent
 * @option {Function} onComponentSnippetDropped Callback will be called after a component snippet is dropped into a container. Arguments: event, newComponent, droppedComponent
 */
!function(t){var n=function(){"undefined"!=typeof console&&t.fn.keditor.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},e=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||e("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||e("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||e("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),t.fn.ckeditor?CKEDITOR.disableAutoInline=!0:e("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),t.fn.keditor=function(t){if(a[t]&&"init"!==t)return a[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on jquery.keditor");return a.init.apply(this,arguments)},t.fn.keditor.debug=!0,t.fn.keditor.version="1.0.0";var o=t.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onInitContentArea:function(t){},onContentChanged:function(t){},onInitContainer:function(t){},onBeforeContainerDeleted:function(t,n){},onContainerDeleted:function(t,n){},onContainerChanged:function(t,n){},onContainerDuplicated:function(t,n,e){},onContainerSelected:function(t,n){},onContainerSnippetDropped:function(t,n,e){},onInitComponent:function(t){},onComponentReady:function(t){},onBeforeComponentDeleted:function(t,n){},onComponentDeleted:function(t,n){},onComponentChanged:function(t,n){},onComponentDuplicated:function(t,n,e){},onComponentSelected:function(t,n){},onComponentSnippetDropped:function(t,n,e){}},i={generateId:function(t){var n=(new Date).getTime();return"keditor-"+t+"-"+n},initSidebar:function(a){n("initSidebar",a);var r=t(document.body);r.addClass("opened-keditor-sidebar"),a.snippetsListId===o.snippetsListId?(n("Render default KEditor snippet container"),r.append('<div id="keditor-sidebar">    <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>    <div id="keditor-snippets-list"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),i.initSidebarToggler()):(n('Render KEditor snippets content after custom snippets list with id="'+a.snippetsListId+'"'),t("#"+a.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof a.snippetsUrl&&a.snippetsUrl.length>0?(n('Getting snippets form "'+a.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:a.snippetsUrl,success:function(t){n("Success in getting snippets",t),i.renderSnippets(t,a),i.initSnippets(a),i.initSnippetsSwitcher(a)},error:function(t){n("Error when getting snippets",t)}})):e('"snippetsUrl" must be not null!')},initSidebarToggler:function(){n("initSidebarToggler");var e=t(document.body);t("#keditor-sidebar-toggler").on("click",function(n){n.preventDefault();var o=t(this).find("i");e.hasClass("opened-keditor-sidebar")?(e.removeClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-left")):(e.addClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-right"))})},renderSnippets:function(e,o){n("renderSnippets",e,o);var i="",a="",r="";t("<div />").html(e).find("> div").each(function(e){var o=t(this),s=o.html().trim(),d=o.attr("data-preview"),c=o.attr("data-type"),l="";n("Snippet #"+e+" type="+c,d,s),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+e+'" data-type="'+c+'">',l+='   <img class="keditor-snippet-preview" src="'+d+'" />',l+="</section>","container"===c?i+=l:"component"===c&&(a+=l),r+='<div id="keditor-snippet-'+e+'" style="display: none;">'+s+"</div>"}),t("#"+o.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+i+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+a+"</div></div>").addClass("loaded-snippets"),t("#keditor-snippets-content").html(r)},initSnippets:function(e){n("initSnippets",e);var o=t("#"+e.snippetsListId);t.fn.niceScroll?(n("Initialize $.fn.niceScroll for snippets list"),o.find(".keditor-snippets").niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):n("$.fn.niceScroll does not exist. Use default sidebar."),n("Initialize $.fn.draggable for container snippets list"),o.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-content-area",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}}),o.find(".keditor-snippet[data-type=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-container-content",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}})},initSnippetsSwitcher:function(e){n("initSnippetsSwitcher",e);var o=t("#keditor-snippets-type-switcher li"),i=t("#keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(n){n.preventDefault(),n.stopImmediatePropagation(),n.stopPropagation();var e=t(this),a=e.parent(),r=e.attr("href");if(!a.hasClass("active")){var s=o.filter(".active"),d=i.filter(".active"),c=t(r);s.removeClass("active"),d.removeClass("active"),a.addClass("active"),c.addClass("active"),t.fn.niceScroll&&(d.getNiceScroll().hide(),c.getNiceScroll().show())}})},initContentArea:function(e,o){if(n("initContentArea",e,o),e.addClass("keditor-content-area"),n("Initialize $.fn.droppable for content area"),e.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for content area"),e.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",sort:function(){t(this).removeClass("ui-state-default")},receive:function(a,r){n("On received snippet",a,r);var s=r.helper,d=r.item,c=t(d.attr("data-snippet")).html();n("Snippet content",c);var l=t('<section class="keditor-container">   <section class="keditor-container-inner">'+c+"</section></section>");s.replaceWith(l),l.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),l.addClass("showed-keditor-toolbar")),"function"==typeof o.onContainerSnippetDropped&&o.onContainerSnippetDropped.call(e,a,l,r.item),i.initContainer(e,l,o),"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,a)}}),n("Initialize existing sections in content area"),e.find("> section").each(function(){var n=t(this);n.addClass("keditor-section-content"),n.wrap('<section class="keditor-section"></section>');var a=n.parent();i.initContainer(e,a,o)}),"function"==typeof o.onInitContentArea){var a=o.onInitContentArea.call(e,e);a&&a.length>0&&t.each(a,function(){var n=t(this);n.wrap('<section class="keditor-section"><section class="keditor-section-content"></section></section>');var a=n.parent().parent();i.initContainer(e,a,o)})}},initContainer:function(e,o,a){if(n("initContainer",e,o,a),o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))n(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container"),n("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container">   <div class="btn-group-vertical">       <a href="#" class="btn btn-xs btn-default btn-container-reposition"><i class="fa fa-sort"></i></a>       <a href="#" class="btn btn-xs btn-default btn-container-duplicate"><i class="fa fa-files-o"></i></a>       <a href="#" class="btn btn-xs btn-default btn-container-delete"><i class="fa fa-times"></i></a>   </div></div>');var r=i.generateId("container");n("Id for container is: "+r),o.attr("id",r);var s=o.find('[data-type="container-content"]');n("Initialize "+s.length+" container content(s)"),s.each(function(){var n=t(this);i.initContainerContent(e,o,n,a)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(e,o),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},initContainerContent:function(e,o,a,r){n("initContainerContent",e,o,a,r);var s=i.generateId("container-content");a.addClass("keditor-container-content"),n("Id for container content id: "+s,a),a.attr("id",s),n("Initialize $.fn.droppable for container content"),a.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for container content"),a.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",sort:function(){t(this).removeClass("ui-state-default")},receive:function(o,a){n("On received snippet",o,a);var s,d=a.helper,c=a.item;if(c.is(".keditor-snippet")){var l=t(c.attr("data-snippet")).html();n("Snippet content",l);var p=t('<section class="keditor-component">   <section class="keditor-component-content">'+l+"</section></section>");d.replaceWith(p),s=p.closest(".keditor-container"),"function"==typeof r.onComponentSnippetDropped&&r.onComponentSnippetDropped.call(e,o,p,a.item),i.initComponent(e,s,p,r)}else s=c.closest(".keditor-container");s.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(e,o,s),"function"==typeof r.onContentChanged&&r.onContentChanged.call(e,o)}}),n("Initialize existing component inside container content"),a.children().each(function(){var n=t(this);n.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>');var a=n.parent().parent();i.initComponent(e,o,a,r)})},initComponent:function(t,e,o,a){if(n("initComponent",t,e,o,a),o.hasClass("keditor-initialized-component")&&o.hasClass("keditor-initializing-component"))n(o.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{o.addClass("keditor-initializing-component"),n("Render KEditor toolbar for component",o),o.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn btn-xs btn-default btn-component-reposition"><i class="fa fa-arrows"></i></a>   <a href="#" class="btn btn-xs btn-default btn-component-duplicate"><i class="fa fa-files-o"></i></a>   <a href="#" class="btn btn-xs btn-default btn-component-delete"><i class="fa fa-times"></i></a></div>'),n("Initialize CKEditor for component",o);var r=o.children(".keditor-component-content");r.prop("contenteditable",!0);var s=i.generateId("component-content");n("Id for component content is: "+s),r.attr("id",s),r.on("input",function(n){"function"==typeof a.onComponentChanged&&a.onComponentChanged.call(t,n,o),"function"==typeof a.onContainerChanged&&a.onContainerChanged.call(t,n,e),"function"==typeof a.onContentChanged&&a.onContentChanged.call(t,n)});var d=r.ckeditor(a.ckeditor).editor;d.on("instanceReady",function(){n("CKEditor is ready",o),"function"==typeof a.onComponentReady&&a.onComponentReady.call(t,o)}),"function"==typeof a.onInitComponent&&a.onInitComponent.call(t,o),o.addClass("keditor-initialized-component"),o.removeClass("keditor-initializing-component")}},initKEditorClicks:function(e){n("initKEditorClicks",e);var o=t(document.body);o.on("click",".keditor-container",function(o){var i=t(this);if(n("Click on .keditor-container",i),!i.hasClass("showed-keditor-toolbar")){t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.addClass("showed-keditor-toolbar");var a=i.parent();"function"==typeof e.onContainerSelected&&e.onContainerSelected.call(a,o,i)}}),o.on("click",".keditor-component",function(o){var i=t(this);if(n("Click on .keditor-component",i),!i.hasClass("showed-keditor-toolbar")){t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.addClass("showed-keditor-toolbar");var a=i.parent();"function"==typeof e.onComponentSelected&&e.onComponentSelected.call(a,o,i)}}),o.on("click",".btn-container-duplicate",function(o){o.preventDefault();var a=t(this);n("Click on .btn-container-duplicate",a);var r=a.closest(".keditor-container"),s=r.parent(),d=t('<section class="keditor-container">   <section class="keditor-container-inner">'+i.getContainerContent(r)+"</section></section>");r.after(d),i.initContainer(s,d,e),n("Container is duplicated"),"function"==typeof e.onContainerDuplicated&&e.onContainerDuplicated.call(s,r,d),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,o)}),o.on("click",".btn-container-delete",function(o){o.preventDefault();var a=t(this);if(n("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();"function"==typeof e.onBeforeContainerDeleted&&e.onBeforeContainerDeleted.call(d,o,r),s.length>0&&s.each(function(){i.deleteComponent(t(this))}),r.remove(),"function"==typeof e.onContainerDeleted&&e.onContainerDeleted.call(d,o,r),"function"==typeof e.onContentChanged&&e.onContentChanged.call(d,o)}}),o.on("click",".btn-component-duplicate",function(o){o.preventDefault();var a=t(this);n("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t('<section class="keditor-component">   <section class="keditor-component-content">'+i.getComponentContent(r)+"</section></section>");r.after(c),i.initComponent(d,s,c,e),n("Component is duplicated"),"function"==typeof e.onComponentDuplicated&&e.onComponentDuplicated.call(d,r,c),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(d,o,s),"function"==typeof e.onContentChanged&&e.onContentChanged.call(d,o)}),o.on("click",".btn-component-delete",function(o){o.preventDefault();var a=t(this);if(n("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-content-area");"function"==typeof e.onBeforeComponentDeleted&&e.onBeforeComponentDeleted.call(s,o,r),i.deleteComponent(r),"function"==typeof e.onComponentDeleted&&e.onComponentDeleted.call(s,o,r),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(s,o,r),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,o)}})},deleteComponent:function(t){n("deleteComponent",t);var e=t.children(".keditor-component-content"),o=e.attr("id"),i=CKEDITOR.instances[o];i&&i.destroy(),t.remove()},getComponentContent:function(t){var n=t.find(".keditor-component-content").attr("id");return CKEDITOR.instances[n].getData()},getContainerContent:function(n){var e=n.children(".keditor-container-inner").clone();return e.find("[data-type=container-content]").each(function(){var n=t(this);n.removeAttr("class").removeAttr("id"),n.children(".keditor-component").each(function(){var n=t(this);n.replaceWith(i.getComponentContent(n))})}),e.html()}},a={init:function(e){var a=t(this);e=t.extend({},o,e),a.each(function(){var e=t(this);if(0===e.attr("id").length){n("Content area does not contain Id. Generating id for content area...");var o=i.generateId("content-area");e.attr("id",o),n('Id for content are is: "'+o+'"')}});var r=t("#"+e.snippetsListId);return r.hasClass("loaded-snippets")?n("Snippets list is already initialized!"):i.initSidebar(e),i.initKEditorClicks(e),a.each(function(){var o=t(this);o.data("keditorOptions")?n("KEditor is already initialized!"):(o.data("keditorOptions",e),i.initContentArea(o,e))}),a},getContent:function(){var n=t(this),e="";return n.children(".keditor-container").each(function(){var n=t(this);e+=i.getContainerContent(n)}),e}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
