/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 2.0.0
 * @dependencies: $, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(e,t){var n=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];console&&"function"==typeof console.log&&s.debug===!0&&console.log.apply(console,["[ KEditor ] "].concat(t))},o=function(e){throw new Error("[ KEditor ] "+e)};t.fn.sortable||o("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var i={nestedContainerEnabled:!0,explicitSnippetEnabled:!1,containerForQuickAddComponent:'\n            <div class="row">\n                <div class="col-sm-12" data-type="container-content">\n                </div>\n            </div>\n        ',btnAddContentText:'<i class="fa fa-plus"></i>',btnAddContainerText:'<i class="fa fa-plus"></i> <i class="fa fa-fw fa-columns"></i>',btnAddSubContainerText:'<i class="fa fa-plus"></i> <i class="fa fa-fw fa-columns"></i>',btnAddComponentText:'<i class="fa fa-plus"></i> <i class="fa fa-fw fa-list-ul"></i>',btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',defaultComponentType:"blank",snippetsUrl:"snippets/snippets.html",snippetsFilterEnabled:!0,snippetsCategoriesSeparator:";",iframeMode:!1,contentStyles:[],contentAreasSelector:null,contentAreasWrapper:'<div class="keditor-ui keditor-content-areas-wrapper"></div>',containerSettingEnabled:!1,containerSettingInitFunction:null,containerSettingShowFunction:null,containerSettingHideFunction:null,onReady:function(){},onSnippetsLoaded:function(e){},onSnippetsError:function(e,t){},onInitIframe:function(e,t,n){},onContentChanged:function(e,t){},onBeforeInitContentArea:function(e){},onInitContentArea:function(e){},onBeforeInitContainer:function(e,t){},onInitContainer:function(e,t){},onBeforeContainerDeleted:function(e,t,n){},onContainerDeleted:function(e,t,n){},onContainerChanged:function(e,t,n){},onContainerDuplicated:function(e,t,n,o){},onContainerSelected:function(e,t,n){},onContainerSnippetAdded:function(e,t,n,o){},onComponentReady:function(e){},onBeforeInitComponent:function(e,t){},onInitComponent:function(e,t){},onBeforeComponentDeleted:function(e,t,n){},onComponentDeleted:function(e,t,n){},onComponentChanged:function(e,t,n){},onComponentDuplicated:function(e,t,n,o){},onComponentSelected:function(e,t,n){},onComponentSnippetAdded:function(e,t,n,o){},onBeforeDynamicContentLoad:function(e,t,n){},onDynamicContentLoaded:function(e,t,n,o,i){},onDynamicContentError:function(e,t,n,o,i){}},a={CONTENT_AREA:0,CONTAINER:1,SUB_CONTAINER:2,CONTAINER_CONTENT:3,SUB_CONTAINER_CONTENT:4,COMPONENT:5},r={ALL:0,CONTAINER:1,COMPONENT:2},s=function(){function s(n,o){_classCallCheck(this,s);var a=this,r=a.element=n,d=a.options=t.extend({},i,o);if(d.iframeMode)a.initIframe();else{a.window=e,a.body=t(document.body);var c=r.val()||r.html()||"",l=a.generateContentAreasWrapper(c);r.is("textarea")?(r.after(l),r.addClass("keditor-hidden-element")):r.empty().append(l),a.contentAreasWrapper=l}a.initSidebar(),a.initSnippetsModal(),a.initContentAreas(),a.body.hasClass("keditor-clicks-initialized")||a.initKEditorClicks(),a.id=a.generateId(),s.instances[a.id]=a,"function"==typeof d.onReady&&d.onReady.call(a)}return _createClass(s,[{key:"generateId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(new Date).getTime(),n=Math.round(9876543210*Math.random());return"keditor-"+e+"-"+t+n}},{key:"generateContentAreasWrapper",value:function(e){var n=this,o=n.options,i=t(o.contentAreasWrapper||"<div />");return i.attr("class","keditor-ui keditor-content-area-wrapper"),i.attr("id")||i.attr("id",n.generateId("content-area-wrapper")),i.html(e),i}},{key:"generateToolbar",value:function(e,t){var n=this,o=n.options,i="";if(!o.explicitSnippetEnabled){var r="";switch(e){case a.CONTENT_AREA:r="keditor-content-area-toolbar";case a.CONTAINER_CONTENT:case a.SUB_CONTAINER_CONTENT:return r="keditor-container-content-toolbar",'\n                            <div class="keditor-ui '+r+'">\n                                <a href="javascript:void(0)" class="keditor-ui keditor-btn keditor-btn-default btn-add-content" title="Add content">'+o.btnAddContentText+"</a>\n                            </div>\n                        "}}switch(e){case a.CONTENT_AREA:return'\n                        <div class="keditor-ui keditor-content-area-toolbar">\n                            <a href="javascript:void(0)" class="keditor-ui keditor-btn keditor-btn-default btn-add-container" title="Add container">'+o.btnAddContainerText+"</a>\n                        </div>\n                    ";case a.CONTAINER:return o.containerSettingEnabled===!0&&(i='<a href="javascript:void(0);" class="keditor-ui btn-container-setting">'+o.btnSettingContainerText+"</a>"),'\n                        <div class="keditor-toolbar keditor-toolbar-container">\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-reposition">'+o.btnMoveContainerText+"</a>\n                            "+i+'\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-duplicate">'+o.btnDuplicateContainerText+'</a>\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-delete">'+o.btnDeleteContainerText+"</a>\n                        </div>\n                    ";case a.SUB_CONTAINER:return o.containerSettingEnabled===!0&&(i='<a href="javascript:void(0);" class="keditor-ui btn-container-setting">'+o.btnSettingContainerText+"</a>"),'\n                        <div class="keditor-toolbar keditor-toolbar-container keditor-toolbar-sub-container">\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-reposition">'+o.btnMoveContainerText+"</a>\n                            "+i+'\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-duplicate">'+o.btnDuplicateContainerText+'</a>\n                            <a href="javascript:void(0);" class="keditor-ui btn-container-delete">'+o.btnDeleteContainerText+"</a>\n                        </div>\n                    ";case a.CONTAINER_CONTENT:return'\n                        <div class="keditor-ui keditor-container-content-toolbar keditor-btn-group">\n                            <a href="javascript:void(0)" class="keditor-ui keditor-btn keditor-btn-default btn-add-container" title="Add sub-container">'+o.btnAddSubContainerText+'</a>\n                            <a href="javascript:void(0)" class="keditor-ui keditor-btn keditor-btn-default btn-add-component" title="Add component">'+o.btnAddComponentText+"</a>\n                        </div>\n                    ";case a.SUB_CONTAINER_CONTENT:return'\n                        <div class="keditor-ui keditor-container-content-toolbar">\n                            <a href="javascript:void(0)" class="keditor-ui keditor-btn keditor-btn-default btn-add-component" title="Add component">'+o.btnAddComponentText+"</a>\n                        </div>\n                    ";case a.COMPONENT:return t&&(i='<a href="javascript:void(0);" class="keditor-ui btn-component-setting">'+o.btnSettingComponentText+"</a>"),'\n                        <div class="keditor-toolbar keditor-toolbar-component">\n                            <a href="javascript:void(0);" class="keditor-ui btn-component-reposition">'+o.btnMoveComponentText+"</a>\n                            "+i+'\n                            <a href="javascript:void(0);" class="keditor-ui btn-component-duplicate">'+o.btnDuplicateComponentText+'</a>\n                            <a href="javascript:void(0);" class="keditor-ui btn-component-delete">'+o.btnDeleteComponentText+"</a>\n                        </div>\n                    "}}},{key:"beautifyCategories",value:function(e){for(var n=[],o=0;o<e.length;o++){var i=e[o]||"";""!==i&&t.inArray(i,n)===-1&&n.push(i)}return n.sort()}},{key:"setSettingContainer",value:function(e){this.settingContainer=e}},{key:"getSettingContainer",value:function(){return this.settingContainer}},{key:"setSettingComponent",value:function(e){this.settingComponent=e}},{key:"getSettingComponent",value:function(){return this.settingComponent}},{key:"getDataAttributes",value:function(e,n,o){var i=o?[]:{};return n||(n=[]),t.each(e.get(0).attributes,function(e,a){0===a.name.indexOf("data-")&&t.inArray(a.name,n)===-1&&(o?i.push(a.name+'="'+a.value+'"'):i[a.name]=a.value)}),i}},{key:"getComponentType",value:function(e){var t=this,i=t.options,a=(e.attr("data-type")||"").replace("component-","");return a&&a in s.components?a:("string"==typeof i.defaultComponentType?a=i.defaultComponentType:"function"==typeof i.defaultComponentType&&(a=i.defaultComponentType.call(t,e)),a||o("Component type is undefined!"),n("Fallback to defaultComponentType: "+a),a)}},{key:"getClickedElement",value:function(e,n){var o=t(e.target),i=o.closest(n);return o.is(n)?o:i.length>0?i:null}},{key:"initIframe",value:function(){n("initIframe");var e=this,o=e.options,i=e.element,a=i.is("textarea")?i.val():i.html(),r=e.iframeWrapper=t('<div class="keditor-ui keditor-iframe-wrapper"></div>'),s=e.iframe=t('<iframe class="keditor-ui keditor-iframe"></iframe>');i.after(r),r.attr("id",e.generateId("iframe-wrapper")).append(s),i.addClass("keditor-hidden-element");var d=e.iframeDoc=s.contents();d.get(0).open(),d.get(0).close(),e.window=s[0].contentWindow?s[0].contentWindow:s[0].contentDocument.defaultView;var c=e.iframeHead=d.find("head"),l=e.iframeBody=e.body=d.find("body");n("Adding styles to iframe...");var p="";t('[data-type="keditor-style"]').each(function(){var e=t(this),n=e.attr("href")||e.attr("data-href")||"";p+=n?'<link rel="stylesheet" type="text/css" href="'+n+'" />\n':'<style type="text/css">'+e.html()+"</style>\n"}),o.contentStyles&&t.isArray(o.contentStyles)&&t.each(o.contentStyles,function(e,t){var n="";t.id&&(n=' id="'+t.id+'" '),p+=t.href?'<link rel="stylesheet" type="text/css" href="'+t.href+'" '+n+" />\n":'<style type="text/css" '+n+">"+t.content+"</style>\n"}),c.append(p),n("Adding original content to iframe...");var f=e.generateContentAreasWrapper(a);l.append(f),e.contentAreasWrapper=f,"function"==typeof o.onInitIframe&&o.onInitIframe.call(e,s,c,l)}},{key:"initKEditorClicks",value:function(){n("initKEditorClicks");var e=this,o=e.options,i=e.body;i.on("click",function(t){var n=e.getClickedElement(t,".keditor-sidebar"),a=e.getClickedElement(t,".keditor-modal"),r=e.getClickedElement(t,".keditor-container");if(r){if(!r.hasClass("showed-keditor-toolbar")){i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),r.addClass("showed-keditor-toolbar");var s=r.parent();"function"==typeof o.onContainerSelected&&o.onContainerSelected.call(e,t,r,s)}}else n||a||(i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"));var d=e.getClickedElement(t,".keditor-component");if(d){if(!d.hasClass("showed-keditor-toolbar")){i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),d.addClass("showed-keditor-toolbar");var c=d.parent();"function"==typeof o.onComponentSelected&&o.onComponentSelected.call(e,t,d,c)}}else n||i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-setting",function(o){o.preventDefault();var a=t(this);n("Click on .btn-container-setting",a);var r=a.closest(".keditor-container");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(e.settingContainer)?e.closeSidebar():e.openSidebar(r)}),i.on("click",".btn-container-duplicate",function(i){i.preventDefault();var a=t(this);n("Click on .btn-container-duplicate",a);var r=a.closest(".keditor-container"),s=r.parent(),d=t(e.getContainerContent(r,a.parent().hasClass("keditor-toolbar-sub-container")));r.after(d),e.convertToContainer(s,d),n("Container is duplicated"),"function"==typeof o.onContainerDuplicated&&o.onContainerDuplicated.call(e,r,d,s),"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,i,s)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();"function"==typeof o.onBeforeContainerDeleted&&o.onBeforeContainerDeleted.call(e,i,r,d);var c=e.settingComponent;if(c){var l=c.closest(".keditor-container");l.is(r)&&(n("Deleting container is container of setting container. Close setting panel for this setting component",c),e.closeSidebar())}else r.is(e.settingContainer)&&(n("Deleting container is setting container. Close setting panel for this container",r),e.closeSidebar());s.length>0&&s.each(function(){e.deleteComponent(t(this))}),r.remove(),"function"==typeof o.onContainerDeleted&&o.onContainerDeleted.call(e,i,r,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,i,d)}}),i.on("click",".btn-component-setting",function(o){o.preventDefault();var a=t(this);n("Click on .btn-component-setting",a);var r=a.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(e.settingComponent())?e.closeSidebar():e.openSidebar(r)}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);n("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t(e.getComponentContent(r));r.after(c),e.convertToComponent(d,s,c),n("Component is duplicated"),"function"==typeof o.onComponentDuplicated&&o.onComponentDuplicated.call(e,r,c,d),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(e,i,s,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,i,d)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=r.closest(".keditor-content-area");"function"==typeof o.onBeforeComponentDeleted&&o.onBeforeComponentDeleted.call(e,i,r,d),r.is(e.settingComponent)&&e.closeSidebar(),e.deleteComponent(r),"function"==typeof o.onComponentDeleted&&o.onComponentDeleted.call(e,i,r,d),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(e,i,s,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,i,d)}}),i.addClass("keditor-clicks-initialized")}},{key:"initSidebar",value:function(){var e=this,i=e.options,a=e.generateId("sidebar"),r=e.sidebar=t('\n                <div class="keditor-ui keditor-sidebar" id="'+a+'">                    \n                    <div class="keditor-ui keditor-sidebar-header">\n                        <span class="keditor-ui keditor-sidebar-title"></span>\n                        <a href="javascript:void(0);" class="keditor-ui keditor-sidebar-close">&times;</a>\n                    </div>\n                    <div class="keditor-ui keditor-sidebar-body"></div>\n                </div>\n            ');r.find(".keditor-sidebar-close").on("click",function(t){t.preventDefault(),e.closeSidebar()});var s=r.find(".keditor-sidebar-body");if(s.on("submit","form",function(e){return e.preventDefault(),!1}),i.containerSettingEnabled===!0)if("function"==typeof i.containerSettingInitFunction){var d=t('<div  class="keditor-ui keditor-setting-form keditor-container-setting"></div>');s.append(d),n("Initialize container setting panel"),i.containerSettingInitFunction.call(e,d,e)}else o('"containerSettingInitFunction" is not function!');r.appendTo(i.iframeMode?e.iframeWrapper:e.body)}},{key:"openSidebar",value:function(e){var o=this,i=o.options,a=o.sidebar,r=a.find(".keditor-sidebar-title"),d=a.find(".keditor-sidebar-body"),c=d.children(".active");if(c.removeClass("active"),e.is(".keditor-component")){o.setSettingComponent(e),o.setSettingContainer(null);var l=o.getComponentType(e),p=s.components[l];r.html(p.settingTitle);var f=d.find(".keditor-setting-"+l);if(0===f.length){var u=s.components[l];if("function"==typeof u.initSettingForm){f=t('\n                            <div \n                                data-type="'+l+'" \n                                class="keditor-ui keditor-setting-form keditor-setting-'+l+' clearfix active"\n                            >\n                            </div>\n                        ');var C=t("<span />").html("Loading...");d.append(f),f.append(C);var m=u.initSettingForm.call(u,f,o);t.when(m).done(function(){n('Initialized setting form for component type "'+l+'"'),setTimeout(function(){C.remove(),"function"==typeof u.showSettingForm&&u.showSettingForm.call(u,f,e,o)},100)})}}else"function"==typeof p.showSettingForm&&p.showSettingForm.call(p,f,e,o),f.addClass("active")}else{o.setSettingContainer(e),o.setSettingComponent(null),r.html("Container Settings");var k=a.find(".keditor-container-setting");"function"==typeof i.containerSettingShowFunction&&i.containerSettingShowFunction.call(o,k,e,o),k.addClass("active")}a.addClass("opened")}},{key:"closeSidebar",value:function(){var e=this,t=e.options,n=e.sidebar,o=n.find(".keditor-sidebar-body").children(".active");if(o.length>0){if(o.is(".keditor-container-setting"))"function"==typeof t.containerSettingHideFunction&&t.containerSettingHideFunction.call(e,o,e);else{var i=o.attr("data-type"),a=s.components[i];"function"==typeof a.hideSettingForm&&a.hideSettingForm.call(a,o,e)}o.removeClass("active")}e.setSettingComponent(null),e.setSettingContainer(null),n.removeClass("opened")}},{key:"showSettingPanel",value:function(e){this.openSidebar(e)}},{key:"hideSettingPanel",value:function(){this.closeSidebar()}},{key:"initSnippetsModal",value:function(){var e=this,i=e.options,a=e.generateId("modal"),s="";s=i.explicitSnippetEnabled?'\n                    <div class="keditor-snippets-wrapper keditor-snippets-wrapper-container">\n                        <div class="keditor-snippets keditor-snippets-container"></div>\n                    </div>\n                    <div class="keditor-snippets-wrapper keditor-snippets-wrapper-component">\n                        <div class="keditor-snippets keditor-snippets-component"></div>\n                    </div>\n                ':'\n                    <div class="keditor-snippets-wrapper">\n                        <div class="keditor-snippets"></div>\n                    </div>\n                ';var d=e.modal=t('\n                <div class="keditor-ui keditor-modal" id="'+a+'">\n                    <div class="keditor-modal-header">\n                        <button type="button" class="keditor-modal-close">&times;</button>\n                        <h4 class="keditor-modal-title"></h4>\n                    </div>\n                    <div class="keditor-modal-body">'+s+'</div>\n                    <div class="keditor-modal-footer">\n                        <button type="button" class="keditor-ui keditor-btn keditor-btn-default keditor-modal-close">Close</button>\n                        <button type="button" class="keditor-ui keditor-btn keditor-btn-primary keditor-modal-add">Add</button>\n                    </div>\n                </div>\n            ');if("string"==typeof i.snippetsUrl&&i.snippetsUrl.length>0){n('Getting snippets form "'+i.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:i.snippetsUrl,success:function(t){n("Success in getting snippets"),"function"==typeof i.onSnippetsLoaded&&(t=i.onSnippetsLoaded.call(e,t)||t),e.renderSnippets(t),i.snippetsFilterEnabled&&(i.explicitSnippetEnabled?(e.initSnippetsFilter(r.CONTAINER),e.initSnippetsFilter(r.COMPONENT)):e.initSnippetsFilter(r.ALL))},error:function(t){n("Error when getting snippets",t),"function"==typeof i.onSnippetsError&&i.onSnippetsError.call(e,t)}}),d.find(".keditor-modal-close").on("click",function(t){t.preventDefault(),e.closeModal()}),d.find(".keditor-modal-add").on("click",function(n){n.preventDefault();var o=d.find(".keditor-snippets-wrapper .selected");if(0!==o.length){var a=e.modalTarget.closest(".keditor-content-area"),s=o.attr("data-type"),c=d.find(o.attr("data-snippet")),l=c.html(),p=!1,f=!1,u=!1;if(i.explicitSnippetEnabled)switch(e.modalSnippetType){case r.COMPONENT:f=!0;break;case r.CONTAINER:p=!0}else if("container"===s)p=!0;else switch(e.modalSnippetType){case r.COMPONENT:f=!0;break;case r.ALL:e.modalTarget.is(".keditor-container-content-inner")?f=!0:u=!0}var C=void 0,m=void 0;if(p&&(e.body.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),C=t('\n                            <section class="keditor-ui keditor-container showed-keditor-toolbar">\n                                <section class="keditor-ui keditor-container-inner">'+l+"</section>\n                            </section>\n                        "),e.modalTarget.append(C),"function"==typeof i.onContainerSnippetAdded&&i.onContainerSnippetAdded.call(e,n,C,o,a),e.initContainer(a,C)),f){var k=e.getDataAttributes(c,null,!0);m=t('\n                            <section class="keditor-ui keditor-component" data-type="'+s+'" '+k.join(" ")+'>\n                                <section class="keditor-ui keditor-component-content">'+l+"</section>\n                            </section>\n                        "),e.modalTarget.append(m);var v=e.modalTarget.closest(".keditor-container");"function"==typeof i.onComponentSnippetAdded&&i.onComponentSnippetAdded.call(e,n,m,o,a),e.initComponent(a,v,m)}if(u){e.body.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar");var h=e.getDataAttributes(c,null,!0);C=t('\n                            <section class="keditor-ui keditor-container showed-keditor-toolbar">\n                                <section class="keditor-ui keditor-container-inner">'+i.containerForQuickAddComponent+"</section>\n                            </section>\n                        "),m=t('\n                            <section class="keditor-ui keditor-component" data-type="'+s+'" '+h.join(" ")+'>\n                                <section class="keditor-ui keditor-component-content">'+l+"</section>\n                            </section>\n                        "),C.find('[data-type="container-content"]').eq(0).html(m),e.modalTarget.append(C),"function"==typeof i.onComponentSnippetAdded&&i.onComponentSnippetAdded.call(e,n,m,o,a),e.initContainer(a,C)}e.closeModal()}}),d.on("click",".keditor-snippet",function(e){e.preventDefault();var n=t(this);n.hasClass("selected")||(n.parent().find(".selected").removeClass("selected"),n.addClass("selected"))});var c="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend";d.on(c,function(){d.hasClass("showed")||(d.css("display","none"),t(document.body).removeClass("opened-modal"))}),d.appendTo(document.body)}else o('"snippetsUrl" must be not null!')}},{key:"renderSnippets",value:function(e){n("renderSnippets");var o=this,i=o.options,a="",r="",s="";o.snippetsCategories=[],o.snippetsContainerCategories=[],o.snippetsComponentCategories=[],t(e).filter("div").each(function(e){var n=t(this),d=o.generateId("snippet"),c=n.html().trim(),l=n.attr("data-preview"),p=n.attr("data-type"),f=n.attr("data-keditor-title"),u=n.attr("data-keditor-categories")||"",C='\n                    <section\n                        class="keditor-ui keditor-snippet"\n                        data-snippet="#'+d+'"\n                        data-type="'+p+'"\n                        title="'+f+'"\n                        data-keditor-categories="'+u+'"\n                    >\n                        <span><span style="background-image: url(\''+l+"')\"></span></span>   \n                    </section>\n                ";u=u.split(i.snippetsCategoriesSeparator),"container"===p?(a+=C,o.snippetsContainerCategories=o.snippetsContainerCategories.concat(u)):p.indexOf("component")!==-1&&(r+=C,o.snippetsComponentCategories=o.snippetsComponentCategories.concat(u));var m=o.getDataAttributes(n,["data-preview","data-type","data-keditor-title","data-keditor-categories"],!0);s+='<script id="'+d+'" type="text/html" '+m.join(" ")+">"+c+"</script>"}),o.snippetsContainerCategories=o.beautifyCategories(o.snippetsContainerCategories),o.snippetsComponentCategories=o.beautifyCategories(o.snippetsComponentCategories),o.snippetsCategories=o.beautifyCategories([].concat(_toConsumableArray(o.snippetsContainerCategories),_toConsumableArray(o.snippetsComponentCategories))),i.explicitSnippetEnabled?(o.modal.find(".keditor-snippets-container").html(a),o.modal.find(".keditor-snippets-component").html(r)):o.modal.find(".keditor-snippets").html(a+r),o.modal.find(".keditor-modal-body").append(s)}},{key:"initSnippetsFilter",value:function(e){n("initSnippetsFilter");var o=this,i=o.options,a=o.modal,s=void 0,d=void 0;switch(e){case r.ALL:s=o.snippetsCategories,d=".keditor-snippets-wrapper";break;case r.CONTAINER:s=o.snippetsContainerCategories,d=".keditor-snippets-wrapper-container";break;case r.COMPONENT:s=o.snippetsComponentCategories,d=".keditor-snippets-wrapper-component"}var c="";t.each(s,function(e,t){c+='<option value="'+t+'">'+t+"</option>"});var l=a.find(d),p=l.find(".keditor-snippets").children(".keditor-snippet");l.prepend('\n                <div class="keditor-ui keditor-snippets-filter-wrapper">\n                    <select class="keditor-ui keditor-snippets-filter">\n                        <option value="" selected="selected">All</option>\n                        '+c+'\n                    </select>\n                    <input type="text" class="keditor-ui keditor-snippets-search" value="" placeholder="Type to search..." />\n                </div>                \n            '),p.each(function(){var e=t(this),n=e.attr("data-keditor-categories")||"",o=n.toLowerCase();n=n.split(i.snippetsCategoriesSeparator),o=o.split(i.snippetsCategoriesSeparator),e.data("categories",n),e.data("categoriesFilter",o)});var f=l.find(".keditor-snippets-search"),u=l.find(".keditor-snippets-filter"),C=function(){var e=(u.val()||"").toLowerCase(),o=(f.val()||"").toLowerCase();p.filter(".selected").removeClass("selected"),e||o?(n("Filtering snippets"),p.each(function(){var n=t(this),i=n.data("categoriesFilter"),a=i.join(";"),r=0;if(e&&t.inArray(e,i)===-1&&r++,o){var s=n.attr("title").toLowerCase();s.indexOf(o)===-1&&a.indexOf(o)===-1&&r++}n[0===r?"removeClass":"addClass"]("not-matched")})):(n("Show all snippets"),p.removeClass("not-matched"))};u.on("change",function(){C()});var m=void 0;f.on("keydown",function(){clearTimeout(m),m=setTimeout(C,200)})}},{key:"openModal",value:function(e,o){n("openModal",e,o);var i=this,a=i.modal,s=i.options,d="";switch(o){case r.CONTAINER:d="Add container";break;case r.COMPONENT:d="Add component"}s.explicitSnippetEnabled?(a.find(".keditor-snippets-wrapper").css("display","none"),a.find(o===r.COMPONENT?".keditor-snippets-wrapper-component":".keditor-snippets-wrapper-container").css("display","block")):(a.find(".keditor-snippets-wrapper").css("display","block").find(".keditor-snippet[data-type=container]").css("display",o===r.COMPONENT?"none":"block"),d="Add content"),a.find(".keditor-modal-title").html(d),i.modalTarget=e,i.modalSnippetType=o,a.css("display","block"),t(document.body).addClass("opened-modal"),setTimeout(function(){a.addClass("showed")},0)}},{key:"closeModal",value:function(){var e=this,t=e.modal;e.modalTarget=null,e.modalAction=null,t.find(".keditor-modal-title").html(""),t.find(".keditor-snippets-wrapper .selected").removeClass("selected"),t.removeClass("showed")}},{key:"initContentAreas",value:function(){n("initContentAreas");var e=this,o=e.contentAreasWrapper,i=e.options,a=void 0;if(i.contentAreasSelector&&(a=o.find(i.contentAreasSelector)),!a||0===a.length){n("Do not find any content area. Creating default content area...");var r=o.html();a=t("<div />").html(r),o.empty().append(a)}a.each(function(){var n=t(this);n.attr("id")||n.attr("id",e.generateId("content-area")),e.initContentArea(n)})}},{key:"initContentArea",value:function(e,o){n("initContentArea",e);var i=this,s=i.options;if(e.addClass("keditor-content-area"),"function"==typeof s.onBeforeInitContentArea&&s.onBeforeInitContentArea.call(i,e),!o){var d=t(i.generateToolbar(a.CONTENT_AREA));e.after(d),d.children(s.explicitSnippetEnabled?".btn-add-container":".btn-add-content").on("click",function(t){t.preventDefault(),i.openModal(e,s.explicitSnippetEnabled?r.CONTAINER:r.ALL)})}if(n("Initialize $.fn.sortable for content area"),e.sortable({handle:".keditor-toolbar-container:not(.keditor-toolbar-sub-container) .btn-container-reposition",items:"> section",helper:"clone",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(t,o){n("On received snippet",t,o);var a=o.helper,r=o.item;a&&a.remove(),i.closeSidebar(),"function"==typeof s.onContentChanged&&s.onContentChanged.call(i,t,e),r.addClass("keditor-ui-dragging"),e.removeClass("keditor-highlighted-dropzone")},start:function(e,t){t.item.addClass("keditor-ui-dragging")},stop:function(t,n){e.removeClass("keditor-highlighted-dropzone"),n.helper&&n.helper.remove(),n.item.removeClass("keditor-ui-dragging")},over:function(){e.addClass("keditor-highlighted-dropzone")},out:function(){e.addClass("keditor-highlighted-dropzone")}}),n("Initialize existing containers in content area"),e.children("section").each(function(){i.convertToContainer(e,t(this))}),"function"==typeof s.onInitContentArea){var c=s.onInitContentArea.call(i,e);c&&c.length>0&&t.each(c,function(){i.convertToContainer(e,t(this))})}}},{key:"convertToContainer",value:function(e,t){n("convertToContainer",e,t);var o=this,i=void 0;t.is("section")?(t.addClass("keditor-ui keditor-container"),t.wrapInner('<section class="keditor-ui keditor-container-inner"></section>'),i=t):(t.wrap('<section class="keditor-ui keditor-container"><section class="keditor-ui keditor-container-inner"></section></section>'),i=t.parent().parent()),o.initContainer(e,i)}},{key:"initContainer",value:function(e,o){var i=this,r=i.options,s=r.nestedContainerEnabled&&o.closest('[data-type="container-content"]').length>0;if(n("initContainer - isNested="+s,e,o),o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))n(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container"),"function"==typeof r.onBeforeInitContainer&&r.onBeforeInitContainer.call(i,o,e),s&&o.addClass("keditor-sub-container"),n("Render KEditor toolbar for container",o),o.append(i.generateToolbar(s?a.SUB_CONTAINER:a.CONTAINER)),o.attr("id",i.generateId(s?"sub-container":"container"));var d=o.find('[data-type="container-content"]');n("Initialize "+d.length+" container content(s)"),d.each(function(){var n=t(this);r.nestedContainerEnabled&&!s&&n.parents('[data-type="container-content"]').length>0||i.initContainerContent(e,o,n,s)}),"function"==typeof r.onInitContainer&&r.onInitContainer.call(i,o,e),
o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}}},{key:"initContainerContent",value:function(e,o,i,s){n("initContainerContent - isNested="+s,e,o,i);var d=this,c=d.options;i.addClass("keditor-container-content"),s&&i.addClass("keditor-sub-container-content"),i.attr("id",d.generateId("container-content"));var l=t('<div class="keditor-container-content-inner"></div>');l.html(i.html()),i.html(l),n("Initialize toolbar for container content");var p=t(d.generateToolbar(s?a.SUB_CONTAINER_CONTENT:a.CONTAINER_CONTENT));p.appendTo(i),c.explicitSnippetEnabled?(s||c.explicitSnippetEnabled&&p.children(".btn-add-container").on("click",function(e){e.preventDefault(),d.openModal(l,r.CONTAINER)}),p.children(".btn-add-component").on("click",function(e){e.preventDefault(),d.openModal(l,r.COMPONENT)})):p.children(".btn-add-content").on("click",function(e){e.preventDefault(),d.openModal(l,s?r.COMPONENT:r.ALL)}),n("Initialize $.fn.sortable for container content"),l.sortable({handle:".btn-component-reposition, .btn-container-reposition",helper:"clone",items:"> section",connectWith:".keditor-container-content-inner",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(o,i){n("On received snippet",o,i);var a=i.helper,r=i.item,s=void 0;a&&a.remove(),s=r.closest(".keditor-container"),s.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof c.onContainerChanged&&c.onContainerChanged.call(d,o,s,e),"function"==typeof c.onContentChanged&&c.onContentChanged.call(d,o,e),r.removeClass("keditor-ui-dragging"),e.removeClass("keditor-highlighted-dropzone")},start:function(e,t){t.item.addClass("keditor-ui-dragging")},stop:function(e,t){l.removeClass("keditor-highlighted-dropzone"),t.helper&&t.helper.remove(),t.item.removeClass("keditor-ui-dragging")},over:function(){l.addClass("keditor-highlighted-dropzone")},out:function(){l.removeClass("keditor-highlighted-dropzone")}}),n("Initialize existing components inside container content"),l.children().each(function(){var n=t(this);n.find('[data-type="container-content"]').length>0?d.convertToContainer(e,n):d.convertToComponent(e,o,n,!0)})}},{key:"convertToComponent",value:function(e,t,o,i){if(n("convertToComponent",e,t,o,i),!o.is(".keditor-container-content-toolbar")){var a=this,r=o.is("section"),s=void 0;r?(o.addClass("keditor-ui keditor-component"),o.wrapInner('<section class="keditor-ui keditor-component-content"></section>'),s=o):(o.wrap('<section class="keditor-ui keditor-component"><section class="keditor-ui keditor-component-content"></section></section>'),s=o.parent().parent()),i&&s.addClass("existing-component"),a.initComponent(e,t,s)}}},{key:"initComponent",value:function(e,o,i){n("initComponent",e,o,i);var r=this,d=r.options;r.body;if(i.hasClass("keditor-initialized-component")&&i.hasClass("keditor-initializing-component"))n(i.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{i.addClass("keditor-initializing-component"),i.attr("id",r.generateId("component")),"function"==typeof d.onBeforeInitComponent&&d.onBeforeInitComponent.call(r,i,e);var c=i.children(".keditor-component-content");c.attr("id",r.generateId("component-content"));var l=r.getComponentType(i);n("Component type: "+l);var p=s.components[l];n("Render KEditor toolbar for component",i),i.append(r.generateToolbar(a.COMPONENT,p.settingEnabled)),i.find("[data-dynamic-href]").each(function(){var e=t(this);r.initDynamicContent(e)}),"function"==typeof p.init?p.init.call(p,e,o,i,r):n('"init" function of component type "'+l+'" does not exist'),"function"==typeof d.onInitComponent&&d.onInitComponent.call(r,i,e),i.addClass("keditor-initialized-component"),i.removeClass("keditor-initializing-component")}}},{key:"initDynamicContent",value:function(e){n("initDynamicContent",e);var o=this,i=o.options,a=e.closest(".keditor-component"),r=e.closest(".keditor-content-area");e.attr("id",o.generateId("dynamic-element")),"function"==typeof i.onBeforeDynamicContentLoad&&i.onBeforeDynamicContentLoad.call(o,e,a,r);var s=e.attr("data-dynamic-href"),d=o.getDataAttributes(a,["data-type","data-dynamic-href"],!1);return d=t.param(d),n("Dynamic href: "+s+", Data: "+d),t.ajax({url:s,data:d,type:"GET",dataType:"HTML",success:function(t,a,s){n("Dynamic content is loaded",e,t,a,s),e.html(t),"function"==typeof i.onDynamicContentLoaded&&i.onDynamicContentLoaded.call(o,e,t,a,s,r)},error:function(t,a,s){n("Error when loading dynamic content",e,t,a,s),"function"==typeof i.onDynamicContentError&&i.onDynamicContentError.call(o,e,t,a,s,r)}})}},{key:"deleteComponent",value:function(e){n("deleteComponent",e);var t=this,o=t.getComponentType(e),i=s.components[o];"function"==typeof i.destroy&&i.destroy.call(i,e,t),e.remove()}},{key:"getComponentContent",value:function(e){n("getComponentContent");var o=this,i=e.clone(),a=o.getComponentType(i),r=s.components[a],d=o.getDataAttributes(i,null,!0),c=void 0;if("function"==typeof r.getContent)c=r.getContent.call(r,i,o);else{var l=i.children(".keditor-component-content");c=l.html()}return i.html(c).find("[data-dynamic-href]").each(function(){t(this).html("")}),"<section "+d.join(" ")+">"+i.html()+"</section>"}},{key:"getContainerContent",value:function(e,o){n("getContainerContent - isNested="+o,e);var i=this,a=e.children(".keditor-container-inner").clone();return a.find("[data-type=container-content]").not(o?"":".keditor-sub-container-content").each(function(){var e=t(this);e.removeClass("keditor-container-content keditor-sub-container-content").removeAttr("id");var n=e.children(),o="";n.children().each(function(){var e=t(this);e.is(".keditor-component")?o+=i.getComponentContent(e):e.is(".keditor-sub-container")&&(o+=i.getContainerContent(e,!0))}),e.html(o)}),"<section>"+a.html()+"</section>"}},{key:"getContent",value:function(e){var n=this,o=[];return n.contentAreasWrapper.find(".keditor-content-area").each(function(){var e="";t(this).children(".keditor-container").each(function(){var o=t(this);e+=n.getContainerContent(o)}),o.push(e)}),e?o:o.join("\n")}},{key:"setContent",value:function(e,t){var n=this,i=n.contentAreasWrapper;t?t.jquery||(t=i.find(t)):t=i.children(".keditor-content-area"),0===t.length&&o("Content area does not exist!"),t.html(e),n.initContentArea(t,!0)}},{key:"destroy",value:function(){var e=this,t=e.element,n=e.id,o=e.getContent(!1);e.options.iframeMode?e.iframeWrapper.remove():e.contentAreasWrapper.remove(),t.is("textarea")?t.val(o):t.html(o),t.removeClass("keditor-hidden-element"),t.data("keditor",null),delete s.instances[n]}}]),s}();t.fn.keditor=function(e){var n=t(this),o=n.data("keditor");return"string"!=typeof e?(o||(o=new s(n,e),n.data("keditor",o)),o):o&&o[e]&&"function"==typeof o[e]?o[e].apply(o,Array.prototype.slice.call(arguments,1)):void 0},t.fn.keditor.constructor=s,s.instances={},s.debug=!1,s.version="@{version}",s.components={blank:{settingEnabled:!1}},s.DEFAULTS=i,s.log=n,s.error=o,e.KEditor=t.keditor=s}(window,jQuery);
//# sourceMappingURL=keditor.min.js.map
